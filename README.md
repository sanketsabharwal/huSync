# **huSync**
### Real-Time Human Synchronization Analysis Using Pose Estimation

Welcome to **huSync**, a Python-based library designed to compute real-time **human synchronization indices** from time-series data generated by human pose estimation systems like **MediaPipe**.

Whether you're analyzing **wrist movements in dance**, tracking **rehabilitation progress**, or studying **human interactions**, huSync can measure how well two time-series signals - such as **body joint movements** - are synchronized and whether they are **in phase** or **out of phase**.

---

## **📋 Features**

- ✅ Real-time processing of two time-series inputs.
- ✅ Calculation of **Synchronization Index (PLV - Phase Locking Value)** using the **Hilbert Transform**.
- ✅ Detection of **IN PHASE** or **OUT OF PHASE** movements.
- ✅ Optional **band-pass filtering** to remove noise.
- ✅ Easy integration with pose estimation libraries like **MediaPipe**.

---

## **📂 Repository Structure**

```
huSync/
├── sync.py   # Core synchronization library
└── test.py   # Example implementation using MediaPipe
```

---

## **🔧 How It Works**

1. **MediaPipe Pose** extracts body landmark coordinates from a video stream.
2. The **y-coordinates** of the **left wrist** and **right wrist** are passed as two time-series inputs to huSync.
3. huSync computes the **Synchronization Index (PLV)** and the **Phase Status** in real-time.

---

## **🚀 Getting Started**

### **1️⃣ Installation**

Clone the repository:

```bash
git clone https://github.com/sanketsabharwal/huSync.git
cd huSync
```

Install the required dependencies:

```bash
pip install opencv-python mediapipe numpy scipy
```

---

### **2️⃣ Running the Example (test.py)**

To see huSync in action:

```bash
python test.py
```

- A **webcam feed** will appear, tracking wrist movements in real time.
- The terminal will display:
  - **Synchronization Index**: A value between 0 and 1 (1 = perfect synchronization).
  - **Phase Status**: Indicates whether the movements are **in phase** or **out of phase**.

**Press 'q'** to quit the application.

---

## **📚 Documentation: Synchronization Class (sync.py)**

The **Synchronization** class processes two time-series signals and computes synchronization metrics.

### **Initialization**

```python
sync = Synchronization(window_size=30, sensitivity=100, output_phase=True, filter_params=None)
```

| **Parameter**    | **Description**                                                    |
|------------------|--------------------------------------------------------------------|
| `window_size`    | Number of data points used to compute the synchronization index.    |
| `sensitivity`    | Number of previous indices stored in history (affects smoothness).  |
| `output_phase`   | Boolean flag to enable phase detection (`True` or `False`).         |
| `filter_params`  | List or tuple `[lowcut, highcut, sampling_rate]` for band-pass filtering. Pass `None` to disable. |

---

### **Method: `process(point1, point2)`**

Processes two time-series points and computes the **Synchronization Index** and **Phase Status**.

| **Argument**  | **Description**                    |
|---------------|------------------------------------|
| `point1`      | First data point (e.g., left wrist). |
| `point2`      | Second data point (e.g., right wrist). |

**Returns**:
- `plv`: **Phase Locking Value** (Synchronization Index).
- `phase_status`: "IN PHASE" or "OUT OF PHASE".

---

### **Method: `bandpass_filter(data)`**

Applies a **band-pass filter** to remove noise and irrelevant frequencies.

| **Argument**  | **Description**                |
|---------------|--------------------------------|
| `data`        | Numpy array of time-series data.|

To disable filtering, pass:

```python
filter_params = None
```

To apply a band-pass filter between 0.5 Hz and 5 Hz at a 30 Hz sampling rate:

```python
filter_params = [0.5, 5.0, 30]
```

---

## **📊 Outputs**

The huSync library produces:

- **Synchronization Index (PLV)**: A value between **0** and **1**.
  - **1.0**: Perfect synchronization.
  - **0.0**: No synchronization.
  
- **Phase Status**:
  - **IN PHASE**: Movements are synchronized in the same direction.
  - **OUT OF PHASE**: Movements are synchronized but in opposite directions.

---

## **💡 Configuration: How `sensitivity` Affects Results**

| **Sensitivity (Maxlen)** | **Effect**                                    | **Pros**                        | **Cons**                           |
|--------------------------|-----------------------------------------------|--------------------------------|------------------------------------|
| **Smaller**               | Faster response to changes.                  | More sensitive to sudden changes.| More susceptible to fluctuations.  |
| **Larger**                | Smoother trend analysis.                     | Less noise in the output.       | Slower response to sudden changes. |

---

## **📈 Example Use Case: Real-Time Wrist Synchronization**

```python
import cv2
import mediapipe as mp
import numpy as np
from sync import Synchronization

def extract_wrist_coordinates(results, keypoint_idx, image_width, image_height):
    """Extract y-coordinate of a given keypoint."""
    keypoint = results.pose_landmarks.landmark[keypoint_idx]
    if keypoint.visibility > 0.5:
        return int(keypoint.y * image_height)
    return None

def main():
    mp_pose = mp.solutions.pose
    pose = mp_pose.Pose(min_detection_confidence=0.5, min_tracking_confidence=0.5)

    sync = Synchronization(window_size=30, output_phase=True)

    cap = cv2.VideoCapture(0)

    LEFT_WRIST_IDX = 15
    RIGHT_WRIST_IDX = 16

    while cap.isOpened():
        ret, frame = cap.read()
        if not ret:
            break

        frame = cv2.flip(frame, 1)
        image = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)

        results = pose.process(image)
        height, width, _ = image.shape

        if results.pose_landmarks:
            left_y = extract_wrist_coordinates(results, LEFT_WRIST_IDX, width, height)
            right_y = extract_wrist_coordinates(results, RIGHT_WRIST_IDX, width, height)

            if left_y is not None and right_y is not None:
                sync.process(left_y, right_y)

        cv2.imshow('MediaPipe Pose', frame)

        if cv2.waitKey(1) & 0xFF == ord('q'):
            break

    cap.release()
    cv2.destroyAllWindows()
    pose.close()

if __name__ == "__main__":
    main()
```

---

## **🧠 How It Works (Technical Explanation)**

1. **Phase Locking Value (PLV)**: Measures how consistently two signals maintain a fixed phase relationship over time.
2. **Hilbert Transform**: Calculates the instantaneous phase of each time-series signal.
3. **Band-Pass Filtering**: Removes noise by filtering out frequencies outside the desired range.

---

## **🛠 Future Improvements**

- ✅ Support for **multi-person synchronization**.
- ✅ Introduce **visualization tools** to plot synchronization indices over time.
- ✅ Add **custom metrics** for advanced use cases.

---

## **💡 Use Cases**

The huSync library is useful in:
- **Human interaction studies**: Measure synchronization in social interactions.
- **Rehabilitation tracking**: Measure synchronization progress in motor tasks.
- **Sports coaching**: Analyze synchronized movements between team members.
- **Dance analysis**: Evaluate synchronization between dancers.

---

## **📜 Citation & Credits**

If you use **huSync** in your research, projects, or publications, please consider citing this work:

```
Sanket Rajeev Sabharwal. huSync: Real-Time Human Synchronization Analysis Using Pose Estimation. https://github.com/sanketsabharwal/huSync, 2025.
```

Alternatively, you can use the following BibTeX format for academic citations:

```bibtex
@misc{sabharwal2025husync,
  author = {Sanket Rajeev Sabharwal},
  title = {huSync: Real-Time Human Synchronization Analysis Using Pose Estimation},
  year = {2025},
  url = {https://github.com/sanketsabharwal/huSync}
}
```

**Credits**  
Developed and maintained by **Sanket Rajeev Sabharwal**.

Feel free to reach out via [X.com](https://x.com/sanketsabharwal) or open an issue on GitHub for questions or feedback.

---
